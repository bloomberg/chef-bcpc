From a59ef7dd023a7ea95fe8ea9250feabe831f6dbc2 Mon Sep 17 00:00:00 2001
From: Kundai Andrew Midzi <kmidzi@bloomberg.net>
Date: Thu, 13 Jul 2017 19:18:56 +0000
Subject: [PATCH 1/2] Pass through target project_id for os-quota-sets:show
 authorisation.

---
 cinder/api/contrib/quotas.py | 8 +-------
 1 file changed, 1 insertion(+), 7 deletions(-)

diff --git a/cinder/api/contrib/quotas.py b/cinder/api/contrib/quotas.py
index ce60066..efb8f54 100644
--- a/cinder/api/contrib/quotas.py
+++ b/cinder/api/contrib/quotas.py
@@ -177,9 +177,9 @@ class QuotaSetsController(wsgi.Controller):
         :param id: target project id that needs to be shown
         """
         context = req.environ['cinder.context']
-        authorize_show(context)
         params = req.params
         target_project_id = id
+        authorize_show(context, target={'project_id': target_project_id})

         if not hasattr(params, '__call__') and 'usage' in params:
             usage = strutils.bool_from_string(params['usage'])
@@ -198,12 +198,6 @@ class QuotaSetsController(wsgi.Controller):

             self._authorize_show(context_project, target_project)

-        try:
-            sqlalchemy_api.authorize_project_context(context,
-                                                     target_project_id)
-        except exception.NotAuthorized:
-            raise webob.exc.HTTPForbidden()
-
         quotas = self._get_quotas(context, target_project_id, usage)
         return self._format_quota_set(target_project_id, quotas)

--
2.7.4
