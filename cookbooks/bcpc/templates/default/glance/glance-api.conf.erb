################################################
#
#              Generated by Chef
#
################################################

# for an overview of all the available configuration options
# go to: https://docs.openstack.org/glance/pike/configuration/glance_api.html
#
[DEFAULT]
debug = <%= node['bcpc']['glance']['debug'] %>
show_image_direct_url = true
enable_v1_api = false
enable_v2_api = true
bind_host = <%=node['bcpc']['management']['ip']%>
bind_port = 9292
workers = <%= node['bcpc']['glance']['workers'] %>
admin_role = <%=node['bcpc']['keystone']['admin_role']%>
image_cache_dir = /var/lib/glance/image-cache/
registry_host = <%= node['bcpc']['management']['vip'] %>
registry_port = 9191
registry_client_protocol = <%= node['bcpc']['protocol']['glance'] %>
log_file = /var/log/glance/api.log
transport_url = rabbit://<%= @servers.map{|x| 'guest:' + get_config('rabbitmq-password') + '@' + x['bcpc']['management']['ip'] + ":5672"}.join(',') %>


[database]
connection = mysql+pymysql://<%=get_config('glance-db-user')%>:<%=get_config('glance-db-password')%>@<%=node['bcpc']['mysql-head']['service_hostname']%>/<%=node['bcpc']['dbname']['glance']%>
max_pool_size=<%= node['bcpc']['glance']['database']['max_pool_size'] %>
max_overflow=<%= node['bcpc']['glance']['database']['max_overflow'] %>


[glance_store]
stores = rbd
default_store = rbd
rbd_store_pool = <%=node['bcpc']['ceph']['images']['name']%>
rbd_store_user = glance
rbd_store_ceph_conf = /etc/ceph/ceph.conf


[image_format]
container_formats = ami,ari,aki,bare,ovf,ova,docker
disk_formats = ami,ari,aki,vhd,vhdx,vmdk,raw,qcow2,vdi,iso,ploop.root-tar


[keystone_authtoken]
auth_uri = <%=node['bcpc']['protocol']['keystone']%>://openstack.<%=node['bcpc']['cluster_domain']%>:5000/v2.0/
auth_url = <%=node['bcpc']['protocol']['keystone']%>://openstack.<%=node['bcpc']['cluster_domain']%>:35357
memcached_servers = <%= @servers.map{|x| x['bcpc']['management']['ip'] + ":11211"}.join(',') %>
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = <%= get_config('glance-os-user') %>
password = <%= get_config('glance-os-password') %>


[oslo_concurrency]
lock_path = /var/lock/glance


[oslo_messaging_rabbit]
amqp_durable_queues = <%=node['bcpc']['rabbitmq']['durable_queues']%>


[paste_deploy]
flavor = keystone
