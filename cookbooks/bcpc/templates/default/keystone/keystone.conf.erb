[DEFAULT]
debug = <%= node['bcpc']['keystone']['debug'] ? 'true' : 'false' %>
log_dir = /var/log/keystone
member_role_name = <%= node['bcpc']['keystone']['member_role'] %>
notification_format = <%= node['bcpc']['keystone']['notification_format'] %>
notification_opt_out = identity.authenticate.success
#backdoor_port = <None>
<% if node['bcpc']['keystone']['debug'] %>
debug = true
<% else %>
debug = false
<% end %>
<% if node['bcpc']['keystone']['verbose'] %>
verbose = true
<% else %>
verbose = false
<% end %>
#log_config_append = <None>
#log_format = <None>
#log_date_format = %Y-%m-%d %H:%M:%S
<% if node['bcpc']['keystone']['log_file'] %>
log_file = <%= node['bcpc']['keystone']['log_file'] %>
<% else %>
#log_file = <None>
<% end %>
#log_dir = <None>
#use_syslog = false
#use_syslog_rfc_format = false
#syslog_log_facility = LOG_USER
#use_stderr = true
#logging_context_format_string = %(asctime)s.%(msecs)03d %(process)d %(levelname)s %(name)s [%(request_id)s %(user_identity)s] %(instance)s%(message)s
#logging_default_format_string = %(asctime)s.%(msecs)03d %(process)d %(levelname)s %(name)s [-] %(instance)s%(message)s
#logging_debug_format_suffix = %(funcName)s %(pathname)s:%(lineno)d
#logging_exception_prefix = %(asctime)s.%(msecs)03d %(process)d TRACE %(name)s %(instance)s
#default_log_levels = amqp=WARN,amqplib=WARN,boto=WARN,qpid=WARN,sqlalchemy=WARN,suds=INFO,oslo.messaging=INFO,iso8601=WARN,requests.packages.urllib3.connectionpool=WARN,urllib3.connectionpool=WARN,websocket=WARN,requests.packages.urllib3.util.retry=WARN,urllib3.util.retry=WARN,keystonemiddleware=WARN,routes.middleware=WARN,stevedore=WARN
#publish_errors = false
#fatal_deprecations = false
#instance_format = "[instance: %(uuid)s] "
#instance_uuid_format = "[instance: %(uuid)s] "
#rpc_zmq_bind_address = *
#rpc_zmq_matchmaker = oslo_messaging._drivers.matchmaker.MatchMakerLocalhost
#rpc_zmq_port = 9501
#rpc_zmq_contexts = 1
#rpc_zmq_topic_backlog = <None>
#rpc_zmq_ipc_dir = /var/run/openstack
#rpc_zmq_host = localhost
#rpc_cast_timeout = 30
#matchmaker_heartbeat_freq = 300
#matchmaker_heartbeat_ttl = 600
#rpc_thread_pool_size = 64
#notification_topics = notifications
rpc_response_timeout=<%= node['bcpc']['keystone']['rpc_response_timeout'] %>
#transport_url = <None>
#rpc_backend = rabbit
#control_exchange = keystone

[assignment]
driver = <%= node['bcpc']['keystone']['drivers']['assignment'] %>


[cache]
enabled = <%= node['bcpc']['keystone']['enable_caching'] ? 'true' : 'false' %>
backend = oslo_cache.memcache_pool
memcache_servers = <%= @servers.map{|x| x['bcpc']['management']['ip'] + ":11211"}.join(',') %>
memcache_dead_retry = 60
memcache_socket_timeout = 1
memcache_pool_connection_get_timeout = 1


[catalog]
driver = <%= node['bcpc']['keystone']['drivers']['catalog'] %>
caching = true
cache_time = 3600


[credential]
driver = <%= node['bcpc']['keystone']['drivers']['credential'] %>


[database]
connection = mysql+pymysql://<%=get_config('mysql-keystone-user')%>:<%=get_config('mysql-keystone-password')%>@<%=@node["bcpc"]["mysql-head"]["service_hostname"]%>/<%=@node['bcpc']['dbname']['keystone']%>
max_overflow = <%= node['bcpc']['keystone']['database']['max_overflow'] %>
max_pool_size = <%= node['bcpc']['keystone']['database']['max_pool_size'] %>


[domain_config]
driver = <%= node['bcpc']['keystone']['drivers']['domain_config'] %>
caching = true
cache_time = 300


[endpoint_filter]
driver = <%= node['bcpc']['keystone']['drivers']['endpoint_filter'] %>


[endpoint_policy]
driver = <%= node['bcpc']['keystone']['drivers']['endpoint_policy'] %>


[federation]
driver = <%= node['bcpc']['keystone']['drivers']['federation'] %>


[fernet_tokens]
key_repository = /etc/keystone/fernet-keys/
max_active_keys = 3


[identity]
driver = <%= node['bcpc']['keystone']['drivers']['identity'] %>
domain_specific_drivers_enabled = true
domain_configurations_from_database = true
caching = true
cache_time = 600


[identity_mapping]
driver = <%= node['bcpc']['keystone']['drivers']['identity_mapping'] %>


[oauth1]
driver = <%= node['bcpc']['keystone']['drivers']['oauth1'] %>


[oslo_messaging_notifications]
<% if node['bcpc']['keystone']['drivers']['notification'] %>
driver = <%= node['bcpc']['keystone']['drivers']['notification'] %>
<% else %>
driver =
<% end %>


[policy]
driver = <%= node['bcpc']['keystone']['drivers']['policy'] %>


[token]
provider = fernet


[trust]
enabled = true
