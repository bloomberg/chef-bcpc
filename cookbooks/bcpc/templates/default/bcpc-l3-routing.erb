#!/bin/sh
################################################
#
#              Generated by Chef
#
################################################

# Add route for storage network
ip route add <%= node['bcpc']['storage']['aggregate']['cidr'] %> \
  via <%= node['bcpc']['storage'][node['bcpc']['rack_name']][node['bcpc']['pod_name']]['gateway'] %> \
  dev <%= node['bcpc']['storage']['interface'] %> \
  table main \
  proto static || true

# Add route for Anycast dummy interface on headnode
ip addr list <%= node['bcpc']['anycast']['interface'] %> | grep <%= node['bcpc']['management']['vip'] %> \
&& ip route add <%= node['bcpc']['management']['vip'] %> \
  dev <%= node['bcpc']['anycast']['interface'] %> || true

# Add route for PowerDNS Anycast dummy interface on headnode
ip addr list <%= node['bcpc']['anycast']['pdns']['interface'] %> | grep <%= node['bcpc']['anycast']['pdns']['ip'] %> \
&& ip route add <%= node['bcpc']['anycast']['pdns']['ip'] %> \
  dev <%= node['bcpc']['anycast']['pdns']['interface'] %> || true
