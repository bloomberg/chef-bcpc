# for an overview of all the available configuration options for placement@stein
# go to: https://docs.openstack.org/placement/stein/configuration/config.html
#
[DEFAULT]
debug = false
ssl_only = false
# TODO: @tstachecki: only for uWSGI?
#key = /etc/placement/ssl-bcpc.key
#cert = /etc/placement/ssl-bcpc.pem
state_path = /var/lib/placement

transport_url = rabbit://<%= @rmqnodes.map{|n| "#{@config['rabbit']['username']}:#{@config['rabbit']['password']}@#{n['service_ip']}:5672" }.join(',') %>

osapi_compute_link_prefix = <%= "https://#{node["bcpc"]['cloud']["fqdn"]}:8778" %>
osapi_compute_listen = <%= node['service_ip'] %>
osapi_compute_workers = <%= node['bcpc']['openstack']['services']['workers'] %>

[api]
auth_strategy = keystone

[keystone_authtoken]
auth_uri = <%= "https://#{@node['bcpc']['cloud']['fqdn']}:5000/" %>
auth_url = <%= "https://#{@node['bcpc']['cloud']['fqdn']}:35357/" %>
memcached_servers = <%= @headnodes.map{ |n| "#{n['service_ip']}:11211" }.join(',') %>
auth_type = password
project_name = service
project_domain_name = Default
user_domain_name = Default
username = <%= @config['placement']['creds']['os']['username'] %>
password = <%= @config['placement']['creds']['os']['password'] %>

[placement_database]
connection = <%= "mysql+pymysql://#{@db['username']}:#{@db['password']}@#{@db['host']}:#{@db['port']}/#{@db['dbname']}" %>
max_overflow = <%= node['bcpc']['placement']['db']['max_overflow'] %>
max_pool_size = <%= node['bcpc']['placement']['db']['max_pool_size'] %>

[oslo_policy]
policy_dirs = policy.d

[oslo_concurrency]
lock_path = /var/lib/placement/tmp

[oslo_messaging_notifications]
# TODO: @tstachecki: placement?
driver = <%= node['bcpc']['nova']['notifications']['driver'] %>
topics = <%= node['bcpc']['nova']['notifications']['topics'] %>

[cache]
enabled = true
backend = oslo_cache.memcache_pool
memcache_servers = <%= @headnodes.map{ |n| "#{n['service_ip']}:11211" }.join(',') %>
