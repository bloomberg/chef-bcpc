- name: default

  description: <%= node['bcpc']['designate']['pool']['description'] %>

  attributes:
    local: true

  # List out the NS records for zones hosted within this pool
  # This should be a record that is created outside of designate, that
  # points to the public IP of the controller node.
  ns_records:
  <% node['bcpc']['designate']['pool']['ns_records'].each do |ns| -%>
    - hostname: <%= ns['hostname'] %>
      priority: <%= ns['priority'] %>
  <% end -%>

  # List out the nameservers for this pool. These are the actual PowerDNS
  # servers. We use these to verify changes have propagated to all nameservers.
  nameservers:
    - host: <%= node['ipaddress'] %>
      port: 5300

  targets:
    - type: pdns4
      description: PowerDNS4 DNS Server

      # List out the designate-mdns servers from which PowerDNS servers should
      # request zone transfers (AXFRs) from.
      masters:
        - host: <%= node['ipaddress'] %>
          port: 5354

      # PowerDNS Configuration options
      options:
        host: <%= node['ipaddress'] %>
        port: 5300
        api_endpoint: http://<%= node['bcpc']['powerdns']['webserver']['address'] %>:<%= node['bcpc']['powerdns']['webserver']['port'] %>
        api_token: <%= @api_key %>

<% if node['bcpc']['designate']['also_notifies'].any? -%>
  also_notifies:
  <% node['bcpc']['designate']['also_notifies'].each do |n| -%>
    - host: <%= n['host'] %>
      port: <%= n['port'] %>
  <% end -%>
<% end -%>
