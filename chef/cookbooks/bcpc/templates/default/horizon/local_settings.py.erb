# -*- coding: utf-8 -*-

import os
from django.utils.translation import ugettext_lazy as _
from horizon.utils import secret_key
from openstack_dashboard.settings import HORIZON_CONFIG

DEBUG = False

ALLOWED_HOSTS = ['*']
SITE_BRANDING = "<%= node['bcpc']['cloud']['region'] %>"
SECRET_KEY = '<%= @config['horizon']['secret'] %>'

WEBROOT = '/horizon'
LOGIN_URL = WEBROOT + '/auth/login/'
LOGOUT_URL = WEBROOT + '/auth/logout/'
LOGIN_REDIRECT_URL = WEBROOT

DEFAULT_THEME = 'default'
AVAILABLE_THEMES = [
  ('default', 'Default', 'themes/default')
]

SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
CSRF_COOKIE_SECURE = True
SESSION_COOKIE_SECURE = True
SHOW_KEYSTONE_V2_RC = False
HORIZON_IMAGES_UPLOAD_MODE = 'off'
TIME_ZONE = "UTC"

OPENSTACK_API_VERSIONS = {
  "identity": 3,
  "image": 2,
  "volume": 3,
  "compute": 2,
}

<% if @domains.any? %>
OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True
OPENSTACK_KEYSTONE_DOMAIN_DROPDOWN = True
OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = 'Default'
OPENSTACK_KEYSTONE_DOMAIN_CHOICES = (
  ('Default', 'Default'),
  <% @domains.each do |domain| %>
  ('<%= domain['name'] %>', '<%= domain['name'] %>'),
  <% end %>
)
<% end %>

OPENSTACK_HOST = "<%= node['bcpc']['cloud']['fqdn'] %>"
OPENSTACK_KEYSTONE_URL = "https://%s:5000/<%= node['bcpc']['catalog']['identity']['uris']['internal'] %>" % OPENSTACK_HOST

OPENSTACK_NEUTRON_NETWORK = {
  'enable_router': True,
  'enable_fip_topology_check': True,
  'supported_provider_types': ['local']
}

SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
CACHES = {
  'default': {
    'BACKEND' : 'django.core.cache.backends.memcached.MemcachedCache',
    'LOCATION' : [<%= @headnodes.map{|n| "'#{n['ipaddress']}:11211'"}.join(',') %>]
  }
}

ROOT_PATH = os.path.dirname(os.path.abspath(__file__))
POLICY_FILES_PATH = os.path.join(ROOT_PATH, "conf")

POLICY_FILES = {
  'identity': 'keystone_policy.json',
  'compute': 'nova_policy.json',
  'volume': 'cinder_policy.json',
  'image': 'glance_policy.json',
  'network': 'neutron_policy.json',
}
